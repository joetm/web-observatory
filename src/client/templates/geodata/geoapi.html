<head>
    <!-- ol3 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ol3/3.15.0/ol-debug.js"></script>
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ol3/3.15.0/ol.css">-->

    <!-- ol3-layerswitcher -->
    <script src="https://cdn.jsdelivr.net/openlayers.layerswitcher/1.1.0/ol3-layerswitcher.js"></script>
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/openlayers.layerswitcher/1.1.0/ol3-layerswitcher.css">-->

    <!-- geoWebObservatory.preview widget deps -->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.js"></script>-->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.js"></script>-->
    <!--<link rel="stylsheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.css">-->
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.6.1/lodash.js"></script>-->

    <style>
        .layer-switcher .panel p, .layer-switcher .panel h5 {
            margin-left: 0.5em;
        }

        .layer-switcher .panel li.layer {
            display: block;
        }

        .layer-switcher .panel li.layer label {
            display: inline;
        }

        .layer-switcher .panel .controls {
            margin-bottom: .5em;
        }

        .layer-switcher .panel .controls label {
            font-size: 70%;
        }

        .layer-switcher .panel .controls input {
            width: 4em;
            display: inline;
            vertical-align: middle;
        }
    </style>
</head>

<template name="geoapi">

    <!-- template for jsfiddle -->
    <script type="text/template" id="template">
        function business() {
        <%
        var layerFactory = window.OL3LayerFactory("template");

        print(_.map(layers, function (layer, id) {
        return "  var " + id + "Layer = " +
        layerFactory(layer.layertype, layer.sourcetype, layer.url, layer.data) +
        ";";
        }).join("\n  "));
        %>
        var baseLayer = new ol.layer.Tile({ source: new ol.source.OSM() });
        var map = new ol.Map({
        target: 'map',
        view: new ol.View({ center: [0, 0], zoom: 2 }),
        layers: [ baseLayer, <%
        print(_.map(_.keys(layers), function (l) {
        return l + "Layer";
        }).join(", "))
        %> ],
        controls: [ new ol.control.LayerSwitcher() ]
        });
        map.getView().fit(ol.extent.boundingExtent(<%= extent %>), map.getSize());
        }

        (function () {
        if (!window.hasOwnProperty("ol")) { return; }
        // Load layerswitcher control here, as it depends on openlayers,
        // but jsfiddle loads External Resources in arbitrary order
        var script = document.createElement("script");
        script.onload = business;
        script.type = "text/javascript";
        script.src = "https://cdn.jsdelivr.net/openlayers.layerswitcher/1.1.0/ol3-layerswitcher.js";
        document.getElementsByTagName("head")[0].appendChild(script);
        }());
    </script>

    <h1>GeoAPIObservatory Widget test</h1>
    <div id="preview-map"></div>
    <pre id="code"></pre>
</template>
